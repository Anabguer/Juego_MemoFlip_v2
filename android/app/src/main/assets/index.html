<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MemoFlip - Inicio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
    }
    
    /* ===== FONDO DEGRADADO ===== */
    .intro-screen {
            position: relative;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      overflow: hidden;
    }
    
    /* ===== CARTAS AMARILLAS CAYENDO ===== */
    #falling-cards-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
    .falling-card {
            position: absolute;
      width: 40px;
      height: 48px;
      background: linear-gradient(45deg, #ffd700, #ffed4e);
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      animation: fall linear infinite;
      opacity: 0;
        }
        
        @keyframes fall {
            0% {
        transform: translateY(-10vh);
                opacity: 0;
            }
      10% {
                opacity: 1;
            }
      90% {
                opacity: 1;
            }
            100% {
        transform: translateY(110vh);
                opacity: 0;
            }
        }
        
    /* ===== CAJA PRINCIPAL (Transparencia para ver cartas) ===== */
    .intro-box {
            position: relative;
            z-index: 10;
      background: rgba(255, 255, 255, 0.1); /* ‚Üê 10% transparencia */
            backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 24px;
      padding: 48px 32px;
      max-width: 450px;
            width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      text-align: center;
      animation: intro-appear 0.8s ease-out;
    }
    
    @keyframes intro-appear {
      from {
            opacity: 0;
            transform: translateY(50px);
        }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
    /* ===== LOGO ===== */
        .logo {
      width: 192px;
            height: auto;
      margin: 0 auto 24px;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }
        
    /* ===== SUBT√çTULO ===== */
        .subtitle {
            color: rgba(255, 255, 255, 0.9);
      font-size: 20px;
            font-weight: 500;
            line-height: 1.6;
      margin-bottom: 48px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    
    /* ===== BOT√ìN JUGAR ===== */
    .btn-play {
      position: relative;
      width: 100%;
      max-width: 280px;
      padding: 12px 24px;
      background: linear-gradient(135deg, #facc15, #eab308);
      border: 2px solid white;
      border-radius: 999px;
      color: white;
      font-size: 20px;
      font-weight: 700;
      cursor: pointer;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(250, 204, 21, 0.4);
      transition: all 0.3s;
      margin: 0 auto 24px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-play:hover {
      transform: scale(1.05) translateY(-3px);
      box-shadow: 0 12px 30px rgba(250, 204, 21, 0.6);
    }
    
    .btn-play:active {
      transform: scale(0.95);
    }
    
    /* ===== BURBUJAS ANIMADAS ===== */
    .btn-bubbles {
      position: absolute;
      inset: 0;
      overflow: hidden;
      border-radius: 999px;
      pointer-events: none;
    }

    /* ===== MODAL AYUDA DE MODOS ===== */
    .help-modal-box {
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 500px;
      margin: 0 16px;
      background: linear-gradient(135deg, #1e293b, #581c87, #1e293b);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      overflow: hidden;
    }

    .help-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .help-modal-header .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .help-modal-header .header-icon {
      padding: 8px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
    }

    .help-modal-header .header-icon .icon {
      width: 24px;
      height: 24px;
      stroke: white;
    }

    .help-modal-header .header-title {
      font-size: 24px;
      font-weight: bold;
      color: white;
      margin: 0;
    }

    .help-modal-header .btn-close {
      padding: 8px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: white;
      font-size: 20px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .help-modal-header .btn-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .help-modal-content {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-height: none;
      overflow-y: visible;
    }

    .help-section {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .help-section-title {
      font-size: 16px;
      font-weight: 600;
      color: white;
      margin: 0;
    }

    .mode-help-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
    }

    .mode-help-icon {
      flex-shrink: 0;
    }

    .help-mode-icon {
      width: 24px;
      height: 24px;
      object-fit: contain;
    }

    .mode-help-text {
      flex: 1;
    }

    .mode-help-text h3 {
      font-size: 16px;
      font-weight: 600;
      color: white;
      margin: 0 0 4px 0;
    }

    .mode-help-text p {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      margin: 0;
      line-height: 1.4;
    }
    
    .bubble {
      position: absolute;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      animation: bubble-float ease-in-out infinite;
    }
    
    .bubble-1 { width: 32px; height: 32px; left: 10%; top: 30%; animation-duration: 3s; --bubble-x: 40px; --bubble-y: -30px; }
    .bubble-2 { width: 24px; height: 24px; right: 15%; top: 60%; animation-duration: 2.5s; animation-delay: 0.5s; --bubble-x: -40px; --bubble-y: 15px; }
    .bubble-3 { width: 16px; height: 16px; left: 20%; bottom: 20%; animation-duration: 4s; animation-delay: 1s; --bubble-x: 60px; --bubble-y: -25px; }
    .bubble-4 { width: 10px; height: 10px; right: 25%; top: 40%; animation-duration: 3.5s; animation-delay: 1.5s; --bubble-x: -70px; --bubble-y: 10px; }
    .bubble-5 { width: 6px; height: 6px; left: 60%; top: 70%; animation-duration: 2.8s; animation-delay: 2s; --bubble-x: 90px; --bubble-y: -15px; }
    
    @keyframes bubble-float {
      0%, 100% {
        transform: translate(0, 0) scale(1);
        opacity: 0.3;
      }
      50% {
        transform: translate(var(--bubble-x), var(--bubble-y)) scale(1.5);
        opacity: 0.7;
      }
    }
    
    .btn-icon {
      width: 48px;
      height: 48px;
    }
    
    /* ===== SELECTOR DE MODOS ===== */
    .mode-selector {
      margin-top: 32px;
    }
    
    .mode-title {
      color: white;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      opacity: 0.9;
    }
    
    .mode-buttons {
            display: flex;
      gap: 6px;
      justify-content: center;
      flex-wrap: nowrap;
    }
    
    .mode-btn {
      padding: 6px 12px;
      font-size: 11px;
      font-weight: 700;
      border-radius: 999px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 4px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      flex: 1;
      justify-content: center;
    }
    
    .mode-icon {
      width: 16px;
      height: 16px;
      object-fit: contain;
    }
    
    .mode-title-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    
    .help-btn {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      font-size: 13px;
            font-weight: bold;
      cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
      transition: all 0.2s;
      margin-top: -10px;
    }
    
    .help-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }
    
    /* ===== BOT√ìN GOOGLE ===== */
    .google-btn {
      width: 100%;
      padding: 14px 32px;
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 999px;
      font-size: 16px;
      font-weight: 700;
            cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-top: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }
    
    .google-btn:hover {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }
    
    .google-icon {
      width: 20px;
      height: 20px;
      filter: brightness(0) invert(1);
    }
    
    /* üé® ESTILOS PARA USUARIO LOGUEADO - SOLO P√çLDORA ROJA */
    .user-logged-in {
      background: transparent !important;
      border: none !important;
      border-radius: 0 !important;
      box-shadow: none !important;
      backdrop-filter: none !important;
      text-shadow: none !important;
      padding: 0 !important;
    }
    
    .user-profile {
      display: flex;
            align-items: center;
      justify-content: center;
      width: 100%;
      padding: 0;
    }
    
    .logout-btn {
      background: rgba(239, 68, 68, 0.3) !important;
      color: white !important;
      border: 1px solid rgba(239, 68, 68, 0.6) !important;
      padding: 12px 20px !important;
            cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      border-radius: 25px !important;
      min-height: 40px !important;
      font-size: 14px !important;
      font-weight: 600 !important;
      text-shadow: none !important;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3) !important;
      backdrop-filter: none !important;
      flex-shrink: 0 !important;
      margin: 0 auto !important;
    }
    
    .logout-btn:hover {
      background: rgba(239, 68, 68, 0.5) !important;
      border-color: rgba(239, 68, 68, 0.8) !important;
      transform: scale(1.1) !important;
    }
    
    .logout-icon {
      width: 18px !important;
      height: 18px !important;
      stroke: white !important;
      stroke-width: 2.5 !important;
    }
    
    .user-nick {
      color: white !important;
      font-weight: 600 !important;
      font-size: 14px !important;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
    }
    
    /* üéÆ MODAL NICK */
    .modal-nick {
      max-width: 400px;
      background: linear-gradient(135deg, #312e81, #581c87, #0f172a);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      z-index: 10000; /* Por delante de todo */
    }
    
    #nickModal {
      z-index: 10000; /* Por delante de todo */
    }
    
    /* Modal overlay base */
    .modal-overlay {
            position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .modal-backdrop {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
    }
    
    .modal-box {
      position: relative;
      z-index: 1001;
      padding: 0;
      margin: 20px;
    }
    
    .modal-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding: 20px 20px 0 20px;
    }
    
    .header-icon {
      font-size: 24px;
    }
    
    .modal-header h2 {
      color: white;
      margin: 0;
      font-size: 20px;
      font-weight: bold;
            text-align: center;
      width: 100%;
    }
    
    .modal-content {
      padding: 0 20px 20px 20px;
    }
    
    .modal-content p {
      color: rgba(255, 255, 255, 0.9);
      margin: 0 0 20px 0;
      text-align: center;
    }
    
    .hidden {
      display: none !important;
    }
    
    .nick-input-container {
      margin: 20px 0;
    }
    
    .nick-input {
      width: 100%;
      padding: 15px 20px;
      font-size: 18px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
      text-align: center;
      margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }
        
    .nick-input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }
    
    .nick-input:focus {
      outline: none;
      border-color: #4ade80;
      box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.3);
    }
    
    
    .modal-buttons {
      margin-top: 20px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }
    
    .mode-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
      color: white;
      transform: translateY(-1px);
    }
    
    .mode-btn.active.beginner {
      background: rgba(250, 204, 21, 0.3);
      border-color: #facc15;
      color: white;
      font-weight: 900;
      box-shadow: 0 4px 12px rgba(250, 204, 21, 0.3);
      transform: translateY(-1px);
    }
    
    .mode-btn.active.normal {
      background: rgba(59, 130, 246, 0.3);
      border-color: #2fdde6;
      color: white;
      font-weight: 900;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      transform: translateY(-1px);
    }
    
    .mode-btn.active.extreme {
      background: rgba(239, 68, 68, 0.3);
      border-color: #ef4444;
      color: white;
      font-weight: 900;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
      transform: translateY(-1px);
        }
    </style>
</head>
<body>
  <div class="intro-screen">
    <!-- Cartas amarillas cayendo -->
    <div id="falling-cards-container"></div>
    
    <!-- Caja principal -->
    <div class="intro-box">
      <img src="logo.png" alt="MemoFlip" class="logo">
      
      <p class="subtitle">
        ¬°No es un simple juego de memoria! Supera mec√°nicas desafiantes
      </p>
      
      <button class="btn-play" id="btn-play">
        <div class="btn-bubbles">
          <div class="bubble bubble-1"></div>
          <div class="bubble bubble-2"></div>
          <div class="bubble bubble-3"></div>
          <div class="bubble bubble-4"></div>
          <div class="bubble bubble-5"></div>
            </div>
            
        <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M8 5v14l11-7z"/>
                    </svg>
        <span id="btn-text">JUGAR</span>
                </button>
                
      <button class="google-btn" id="btn-google-login">
        <svg class="google-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
        <span>Entrar con Google</span>
                    </button>
                
      <div class="mode-selector">
        <div class="mode-title-row">
          <p class="mode-title">Modo de juego</p>
          <button class="help-btn" onclick="showModeHelp()">?</button>
        </div>
        <div class="mode-buttons">
          <button class="mode-btn beginner" data-mode="beginner">
            <img src="relax.png" alt="Relax" class="mode-icon">
            <span>Relax</span>
          </button>
          <button class="mode-btn normal active" data-mode="normal">
            <img src="normal.png" alt="Normal" class="mode-icon">
            <span>Normal</span>
          </button>
          <button class="mode-btn extreme" data-mode="extreme">
            <img src="extremo.png" alt="Extremo" class="mode-icon">
            <span>Extremo</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
  <!-- üéÆ MODAL PARA PEDIR NICK -->
  <div id="nickModal" class="modal-overlay hidden">
    <div class="modal-backdrop"></div>
    
    <div class="modal-box modal-nick">
      <!-- Header -->
      <div class="modal-header">
        <h2>¬°Bienvenido a MemoFlip!</h2>
    </div>
    
      <!-- Content -->
      <div class="modal-content">
        <p>Elige tu nombre de jugador:</p>
        
        <div class="nick-input-container">
          <input 
            type="text" 
            id="nickInput" 
            placeholder="Tu nick aqu√≠..." 
            maxlength="20"
            class="nick-input"
          >
        </div>
        
        <div class="modal-buttons">
          <button class="btn btn-primary" onclick="confirmNick()">
            ¬°JUGAR!
          </button>
        </div>
      </div>
    </div>
    </div>
    
    <script>
    // ---------- CALLBACKS NATIVOS ----------
    window.__onNativeLogin = function(payloadStr) {
      console.log('üéØ __onNativeLogin llamado con:', payloadStr);
      const p = JSON.parse(payloadStr);
      
      // Guarda usuario en localStorage (modo offline)
      localStorage.setItem('user', JSON.stringify(p));
      
      // Si tiene nick, cambia bot√≥n a "puertita + nick"
      if (p.hasNick) {
        console.log('‚úÖ Usuario con nick existente:', p.nick);
        setUILoggedIn(p.nick);
      } else {
        console.log('‚ùå Usuario sin nick, pidiendo nick...');
        // Pedir nick SOLO si no existe en Firestore
        showNickModal(p);
      }
    };
    
    window.__onNativeLogout = function() {
      console.log('üö™ __onNativeLogout llamado');
      console.log('üßπ Limpiando localStorage...');
      console.log('üîç localStorage antes:', {
        user: localStorage.getItem('user'),
        memoflip_user: localStorage.getItem('memoflip_user')
      });
      
      localStorage.removeItem('user');
      localStorage.removeItem('memoflip_user');
      
      // Limpiar progreso del usuario logueado para volver a modo invitado
      localStorage.removeItem('memoflip_progress_normal');
      localStorage.removeItem('memoflip_progress_beginner');
      localStorage.removeItem('memoflip_progress_extreme');
      localStorage.removeItem('lastUserUid');
      
      console.log('üîç localStorage despu√©s:', {
        user: localStorage.getItem('user'),
        memoflip_user: localStorage.getItem('memoflip_user')
      });
      
      console.log('üé® Actualizando UI a estado no logueado...');
      setUILoggedOut(); // cambia a bot√≥n "Entrar con Google"
      console.log('‚úÖ Logout completado');
    };
    
    window.__onNativeLoginError = function(error) {
      console.error('‚ùå __onNativeLoginError:', error);
      alert('Error en login: ' + error);
    };
    
    window.__onSaveNick = function(ok, err) {
      console.log('üíæ __onSaveNick:', ok, err);
      if (ok) {
        const u = JSON.parse(localStorage.getItem('user') || '{}');
        const nick = document.querySelector('#nickInput').value.trim();
        u.hasNick = true;
        u.nick = nick;
        localStorage.setItem('user', JSON.stringify(u));
        setUILoggedIn(nick);
        closeNickPrompt();
      } else {
        if (err === 'nick_taken') {
          showNickTakenModal();
        } else {
          showErrorModal('‚ùå No se pudo guardar el nick: ' + (err || 'Error desconocido'));
        }
      }
    };
    
    // üé® MODALES DE ERROR BONITAS
    function showNickTakenModal() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        backdrop-filter: blur(10px);
      `;
      
      modal.innerHTML = `
        <div class="modal-content" style="
          background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(185, 28, 28, 0.95));
          border: 2px solid #ef4444;
          border-radius: 20px;
          padding: 30px;
          max-width: 400px;
          width: 90%;
          text-align: center;
          color: white;
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
          backdrop-filter: blur(20px);
        ">
          <div style="font-size: 48px; margin-bottom: 20px;">üò§</div>
          <h2 style="margin: 0 0 15px 0; font-size: 24px; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">
            ¬°Nick Ocupado!
          </h2>
          <p style="margin: 0 0 25px 0; font-size: 16px; line-height: 1.5; opacity: 0.9;">
            Este nick ya est√° siendo usado por otro jugador.<br>
            ¬°Elige uno diferente y s√© √∫nico! ‚ú®
          </p>
          <button onclick="this.closest('.modal-overlay').remove()" style="
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: 2px solid #fca5a5;
            border-radius: 12px;
            padding: 12px 24px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
            Entendido
          </button>
        </div>
      `;
      
      document.body.appendChild(modal);
    }
    
    function showErrorModal(message) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        backdrop-filter: blur(10px);
      `;
      
      modal.innerHTML = `
        <div class="modal-content" style="
          background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(185, 28, 28, 0.95));
          border: 2px solid #ef4444;
          border-radius: 20px;
          padding: 30px;
          max-width: 400px;
          width: 90%;
          text-align: center;
          color: white;
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
          backdrop-filter: blur(20px);
        ">
          <div style="font-size: 48px; margin-bottom: 20px;">‚ö†Ô∏è</div>
          <h2 style="margin: 0 0 15px 0; font-size: 24px; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">
            Error
          </h2>
          <p style="margin: 0 0 25px 0; font-size: 16px; line-height: 1.5; opacity: 0.9;">
            ${message}
          </p>
          <button onclick="this.closest('.modal-overlay').remove()" style="
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: 2px solid #fca5a5;
            border-radius: 12px;
            padding: 12px 24px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
            Entendido
          </button>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    // üî• ANDROID NATIVO - NO NECESITAMOS FIREBASE WEB SDK
    console.log('üì± Usando Android nativo para Firebase');
    
    // üîç VERIFICAR SI YA EST√Å LOGUEADO
    function checkLoginStatus() {
      console.log('üîç Verificando estado de login...');
      console.log('üîç localStorage completo:', localStorage);
      
      const user = localStorage.getItem('user');
      console.log('üîç user encontrado:', user);
      
      if (user) {
        try {
          const userData = JSON.parse(user);
          console.log('üë§ Usuario ya logueado:', userData);
          console.log('üë§ Nick del usuario:', userData.nick);
          
          if (userData.hasNick && userData.nick) {
            setUILoggedIn(userData.nick);
            return true;
          } else {
            console.log('‚ùå Usuario sin nick, pidiendo nick...');
            showNickModal(userData);
            return true;
          }
        } catch (error) {
          console.error('‚ùå Error parseando usuario:', error);
          localStorage.removeItem('user');
        }
      } else {
        console.log('‚ùå No hay usuario logueado, mostrando bot√≥n Google');
      }
      return false;
    }
    
    // üé® MOSTRAR INTERFAZ DE USUARIO LOGUEADO
    function showLoggedInUI(user) {
      console.log('üé® Mostrando interfaz de usuario logueado para:', user.nick);
      const googleBtn = document.getElementById('btn-google-login');
      if (googleBtn) {
        googleBtn.innerHTML = `
          <div class="user-profile">
            <button class="logout-btn" id="logout-button" title="Cerrar sesi√≥n">
              <svg class="logout-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16,17 21,12 16,7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
              </svg>
              <span class="user-nick">${user.nick}</span>
            </button>
          </div>
        `;
        googleBtn.className = 'google-btn user-logged-in';
        
        // Remover el onclick del bot√≥n padre
        googleBtn.onclick = null;
        
        // A√±adir event listener a toda la p√≠ldora de usuario
        setTimeout(() => {
          const userProfile = document.querySelector('.user-profile');
          if (userProfile) {
            console.log('üîç P√≠ldora de usuario encontrada, a√±adiendo event listener');
            userProfile.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              console.log('üö™ P√≠ldora de usuario presionada (addEventListener)');
              logout();
            });
            console.log('‚úÖ Event listener a√±adido a toda la p√≠ldora');
            } else {
            console.error('‚ùå P√≠ldora de usuario no encontrada');
          }
        }, 100);
        
        console.log('‚úÖ UI actualizada para usuario logueado');
        console.log('üîç Funci√≥n logout disponible:', typeof window.logout);
      }
    }
    
    // üö™ FUNCI√ìN LOGOUT
    // Funci√≥n para logout (GLOBAL)
    window.logout = function() {
      console.log('üö™ Iniciando logout...');
      console.log('üîç AndroidInterface disponible:', !!window.AndroidInterface);
      console.log('üîç AndroidInterface.logout disponible:', !!(window.AndroidInterface && window.AndroidInterface.logout));
      
      if (window.AndroidInterface && window.AndroidInterface.logout) {
        console.log('üì± Llamando a AndroidInterface.logout()...');
        window.AndroidInterface.logout();
        console.log('‚úÖ AndroidInterface.logout() llamado');
      } else {
        console.error('‚ùå AndroidInterface.logout no disponible');
        // Fallback: limpiar localStorage y recargar
        console.log('üîÑ Usando fallback: limpiar localStorage y recargar');
        localStorage.clear();
        location.reload();
      }
    }
    
    // Funci√≥n para guardar nick
    function saveNick(nick) {
      console.log('üíæ Guardando nick:', nick);
      if (window.AndroidInterface && window.AndroidInterface.saveNick) {
        window.AndroidInterface.saveNick(nick);
      } else {
        console.error('‚ùå AndroidInterface.saveNick no disponible');
      }
    }
    
    // Funciones de UI
    function setUILoggedIn(nick) {
      console.log('üé® Actualizando UI para usuario logueado:', nick);
      const googleBtn = document.getElementById('btn-google-login');
      if (googleBtn) {
        googleBtn.innerHTML = `
          <div class="user-profile">
            <button class="logout-btn" id="logout-button" title="Cerrar sesi√≥n">
              <svg class="logout-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16,17 21,12 16,7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
              </svg>
              <span class="user-nick">${nick}</span>
            </button>
          </div>
        `;
        googleBtn.className = 'google-btn user-logged-in';
        
        // Remover el onclick del bot√≥n padre
        googleBtn.onclick = null;
        
        // A√±adir event listener a toda la p√≠ldora de usuario
        setTimeout(() => {
          const userProfile = document.querySelector('.user-profile');
          if (userProfile) {
            console.log('üîç P√≠ldora de usuario encontrada, a√±adiendo event listener');
            userProfile.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              console.log('üö™ P√≠ldora de usuario presionada (addEventListener)');
              logout();
            });
            console.log('‚úÖ Event listener a√±adido a toda la p√≠ldora');
          } else {
            console.error('‚ùå P√≠ldora de usuario no encontrada');
          }
        }, 100);
        
        console.log('‚úÖ UI actualizada para usuario logueado');
        console.log('üîç Funci√≥n logout disponible:', typeof window.logout);
        
        // Actualizar color del nick seg√∫n el modo actual (con delay para que se renderice)
        setTimeout(() => {
          updateNickColor(currentMode);
        }, 100);
      }
    }
    
    // ===== ACTUALIZAR COLOR DEL NICK SEG√öN MODO =====
    function updateNickColor(mode) {
      console.log('üé® Actualizando color del nick para modo:', mode);
      
      const userNickElement = document.querySelector('.user-nick');
      if (!userNickElement) {
        console.log('‚ùå No se encontr√≥ elemento .user-nick');
        return;
      }
      
      // Colores seg√∫n el modo (iguales que en el juego)
      const modeColors = {
        'beginner': '#facc15',  // Amarillo dorado
        'normal': '#2fdde6',    // Azul cyan
        'extreme': '#ef4444'    // Rojo
      };
      
      const color = modeColors[mode] || modeColors['normal'];
      userNickElement.style.color = color;
      
      console.log('üé® Color aplicado al nick:', color, 'para modo:', mode);
    }
    
    function setUILoggedOut() {
      console.log('üé® Actualizando UI para usuario no logueado');
      const googleBtn = document.getElementById('btn-google-login');
      if (googleBtn) {
        googleBtn.innerHTML = `
          <svg class="google-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
            <path d="M12 23c6.08 0 11-4.92 11-11S18.08 1 12 1 1 5.92 1 12s4.92 11 11 11z"/>
            <path d="M12 11.38v4.25h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09 0-1.25-.2-2.45-.57-3.54H12z"/>
          </svg>
          Entrar con Google
        `;
        googleBtn.className = 'google-btn';
        googleBtn.onclick = loginWithGoogle;
        console.log('‚úÖ UI actualizada para usuario no logueado');
      }
    }
    
    // Cartas cayendo
    const container = document.getElementById('falling-cards-container');
    
    function createFallingCard() {
      const card = document.createElement('div');
      card.className = 'falling-card';
      card.style.left = Math.random() * 100 + '%';
      card.style.animationDuration = (Math.random() * 4 + 3) + 's';
      container.appendChild(card);
      setTimeout(() => card.remove(), 7000);
    }
    
    setInterval(createFallingCard, 1500);
    for (let i = 0; i < 3; i++) setTimeout(createFallingCard, i * 500);
    
    // Modos - Cargar modo guardado
    let currentMode = localStorage.getItem('memoflip_selected_mode') || 'normal';
    
    // Activar bot√≥n del modo guardado
    const savedModeButton = document.querySelector(`.mode-btn[data-mode="${currentMode}"]`);
    if (savedModeButton) {
        savedModeButton.classList.add('active');
        console.log('‚úÖ Modo guardado cargado:', currentMode);
    }
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentMode = btn.dataset.mode;
        
        // Cambiar color del nick seg√∫n el modo
        updateNickColor(currentMode);
        
        // Modo seleccionado (sin modal)
        console.log('üéØ Modo seleccionado:', btn.dataset.mode);
      };
    });
    
    // ===== FRASES MOTIVACIONALES POR MODO =====
    function showModeMotivationalMessage(mode) {
      console.log('üéØ Mostrando mensaje motivacional para modo:', mode);
      const messages = {
        'beginner': {
          title: 'üåø Modo Relax',
          message: '¬°Perfecto para relajarte! Sin presi√≥n de tiempo, disfruta del juego a tu ritmo y mejora tu memoria de forma tranquila.'
        },
        'normal': {
          title: '‚ö° Modo Normal',
          message: '¬°El equilibrio perfecto! Tienes tiempo limitado para completar cada nivel. ¬°Demuestra tu habilidad y concentraci√≥n!'
        },
        'extreme': {
          title: 'üî• Modo Extremo',
          message: '¬°Est√°s preparado para el desaf√≠o m√°ximo! Cada nivel te retar√° con mec√°nicas especiales y tiempo muy limitado. ¬°Demuestra que eres un verdadero maestro de la memoria!'
        }
      };

      const messageData = messages[mode];
      if (messageData) {
        // Crear modal temporal para mostrar el mensaje
        showTemporaryMessage(messageData.title, messageData.message, mode);
      }
    }

    // ===== MOSTRAR MENSAJE TEMPORAL BONITO =====
    function showTemporaryMessage(title, message, mode = 'normal') {
      // Colores seg√∫n el modo (iguales que los botones)
      const modeColors = {
        'beginner': {
          background: 'linear-gradient(135deg, rgba(250, 204, 21, 0.3), rgba(234, 179, 8, 0.3))',
          border: '2px solid #facc15',
          titleColor: '#facc15',
          emoji: 'üåÖ',
          boxShadow: '0 20px 40px rgba(250, 204, 21, 0.2)'
        },
        'normal': {
          background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(37, 99, 235, 0.3))',
          border: '2px solid #2fdde6',
          titleColor: '#2fdde6',
          emoji: '‚ö°',
          boxShadow: '0 20px 40px rgba(59, 130, 246, 0.2)'
        },
        'extreme': {
          background: 'linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(185, 28, 28, 0.3))',
          border: '2px solid #ef4444',
          titleColor: '#ef4444',
          emoji: 'üî•',
          boxShadow: '0 20px 40px rgba(239, 68, 68, 0.2)'
        }
      };

      const colors = modeColors[mode] || modeColors['normal'];

      // Crear overlay
      const overlay = document.createElement('div');
      overlay.className = 'temp-message-overlay';
      overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        backdrop-filter: blur(15px);
        animation: fadeIn 0.3s ease-out;
      `;

      // Crear modal
      const modal = document.createElement('div');
      modal.className = 'temp-message-modal';
      modal.style.cssText = `
        background: ${colors.background};
        border-radius: 25px;
        padding: 35px;
        max-width: 380px;
        width: 90%;
        text-align: center;
        box-shadow: ${colors.boxShadow};
        border: ${colors.border};
        animation: slideInScale 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        backdrop-filter: blur(20px);
      `;

      modal.innerHTML = `
        <div style="position: relative;">
          <div style="font-size: 64px; margin-bottom: 20px; animation: bounce 0.6s ease-in-out 0.2s both;">${colors.emoji}</div>
          <h2 style="color: ${colors.titleColor}; font-size: 26px; font-weight: 800; margin: 0 0 15px 0; text-shadow: 0 3px 6px rgba(0, 0, 0, 0.4); letter-spacing: 0.5px;">
            ${title}
          </h2>
          <p style="color: rgba(255, 255, 255, 0.95); font-size: 16px; line-height: 1.6; margin: 0 0 25px 0; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); font-weight: 500;">
            ${message}
          </p>
          <button class="close-btn" style="
            background: linear-gradient(135deg, ${colors.titleColor}, ${colors.titleColor}dd);
            border: 2px solid ${colors.titleColor}aa;
            border-radius: 15px;
            padding: 12px 28px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
          " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(0, 0, 0, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 6px 20px rgba(0, 0, 0, 0.3)'">
            ¬°Entendido!
          </button>
        </div>
      `;

      // A√±adir animaciones CSS
      const style = document.createElement('style');
      style.textContent = `
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideInScale {
          from {
            opacity: 0;
            transform: translateY(-30px) scale(0.8);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        @keyframes bounce {
          0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
          }
          40% {
            transform: translateY(-10px);
          }
          60% {
            transform: translateY(-5px);
          }
        }
        @keyframes slideOutScale {
          from {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
          to {
            opacity: 0;
            transform: translateY(-30px) scale(0.8);
          }
        }
      `;
      document.head.appendChild(style);

      overlay.appendChild(modal);
      document.body.appendChild(overlay);

      // Funci√≥n para cerrar el modal
      const closeModal = () => {
        overlay.style.animation = 'slideOutScale 0.3s ease-in forwards';
        setTimeout(() => {
          if (overlay.parentNode) {
            overlay.parentNode.removeChild(overlay);
          }
          if (style.parentNode) {
            style.parentNode.removeChild(style);
          }
        }, 300);
      };

      // Cerrar al hacer clic en el bot√≥n
      const closeBtn = modal.querySelector('.close-btn');
      closeBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        closeModal();
      });

      // Cerrar al hacer clic fuera del modal
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          closeModal();
        }
      });
    }
    
    // Bot√≥n jugar
    document.getElementById('btn-play').onclick = () => {
      // Marcar que el usuario ha interactuado (para permitir m√∫sica autom√°tica)
      localStorage.setItem('memoflip_user_interacted', 'true');
      
      // Guardar modo seleccionado
      localStorage.setItem('memoflip_selected_mode', currentMode);
      
      // Guardar modo en Firestore si hay usuario logueado
      const user = localStorage.getItem('user');
      if (user && window.AndroidInterface && window.AndroidInterface.saveGameProgress) {
        try {
          const userData = JSON.parse(user);
          const progressData = {
            uid: userData.uid,
            nick: userData.nick,
            email: userData.email,
            displayName: userData.displayName,
            selectedMode: currentMode,
            lastUpdated: new Date().toISOString()
          };
          window.AndroidInterface.saveGameProgress(JSON.stringify(progressData));
          console.log('üéØ Modo guardado en Firestore:', currentMode);
        } catch (error) {
          console.error('‚ùå Error guardando modo en Firestore:', error);
        }
      }
      
      // Marcar que se debe reproducir m√∫sica al entrar al juego
      if (!user) {
        // No hay usuario logueado - reproducir por defecto
        console.log('üéµ Marcando para reproducir m√∫sica al entrar al juego (usuario no logueado)');
        localStorage.setItem('memoflip_should_play_music', 'true');
      } else {
        // Hay usuario logueado - verificar configuraciones
        const settings = JSON.parse(localStorage.getItem('memoflip_settings') || '{"soundEnabled":true}');
        if (settings.soundEnabled) {
          console.log('üéµ Marcando para reproducir m√∫sica al entrar al juego (usuario logueado con sonido habilitado)');
          localStorage.setItem('memoflip_should_play_music', 'true');
        } else {
          console.log('üéµ Usuario logueado tiene sonido deshabilitado, no reproduciendo');
          localStorage.removeItem('memoflip_should_play_music');
        }
      }
      
      // Ir al juego
      window.location.href = 'game.html';
    };
    
    // üîç VERIFICAR LOGIN AL CARGAR LA P√ÅGINA
    document.addEventListener('DOMContentLoaded', () => {
      checkLoginStatus();
      
      // Inicializar color del nick seg√∫n el modo actual
      updateNickColor(currentMode);
      
      // Verificar con Android nativo si hay usuario logueado
      if (window.AndroidInterface && window.AndroidInterface.getUser) {
        console.log('üîç Llamando a AndroidInterface.getUser()...');
        window.AndroidInterface.getUser();
      } else {
        console.log('‚ùå AndroidInterface.getUser no disponible');
      }
    });
    
    // Funci√≥n de ayuda para modos
    function showModeHelp() {
      document.getElementById('help-modal').classList.remove('hidden');
    }

    // Funci√≥n para cerrar modal de ayuda
    function closeHelpModal() {
      document.getElementById('help-modal').classList.add('hidden');
    }
    
    // Funci√≥n para login con Google
    function loginWithGoogle() {
      console.log('üîê Iniciando login con Google...');
      if (window.AndroidInterface && window.AndroidInterface.login) {
        window.AndroidInterface.login();
      } else {
        console.error('‚ùå AndroidInterface.login no disponible');
      }
    }
    
    // Bot√≥n jugar
    document.getElementById('btn-play').onclick = () => {
      // Marcar que el usuario ha interactuado (para permitir m√∫sica autom√°tica)
      localStorage.setItem('memoflip_user_interacted', 'true');
      
      // Guardar modo seleccionado
      localStorage.setItem('memoflip_selected_mode', currentMode);
      
      // Guardar modo en Firestore si hay usuario logueado
      const user = localStorage.getItem('user');
      if (user && window.AndroidInterface && window.AndroidInterface.saveGameProgress) {
        try {
          const userData = JSON.parse(user);
          const progressData = {
            uid: userData.uid,
            nick: userData.nick,
            email: userData.email,
            displayName: userData.displayName,
            selectedMode: currentMode,
            lastUpdated: new Date().toISOString()
          };
          window.AndroidInterface.saveGameProgress(JSON.stringify(progressData));
          console.log('üéØ Modo guardado en Firestore:', currentMode);
        } catch (error) {
          console.error('‚ùå Error guardando modo en Firestore:', error);
        }
      }
      
      // Marcar que se debe reproducir m√∫sica al entrar al juego
      if (!user) {
        // No hay usuario logueado - reproducir por defecto
        console.log('üéµ Marcando para reproducir m√∫sica al entrar al juego (usuario no logueado)');
        localStorage.setItem('memoflip_should_play_music', 'true');
      } else {
        // Hay usuario logueado - verificar configuraciones
        const settings = JSON.parse(localStorage.getItem('memoflip_settings') || '{"soundEnabled":true}');
        if (settings.soundEnabled) {
          console.log('üéµ Marcando para reproducir m√∫sica al entrar al juego (usuario logueado con sonido habilitado)');
          localStorage.setItem('memoflip_should_play_music', 'true');
        } else {
          console.log('üéµ Usuario logueado tiene sonido deshabilitado, no reproduciendo');
          localStorage.removeItem('memoflip_should_play_music');
        }
      }
      
      // Ir al juego
      window.location.href = 'game.html';
    };
    
    // Funci√≥n para login con Google
    function loginWithGoogle() {
      console.log('üîê Iniciando login con Google...');
      if (window.AndroidInterface && window.AndroidInterface.login) {
        window.AndroidInterface.login();
      } else {
        console.error('‚ùå AndroidInterface.login no disponible');
        alert('Error: AndroidInterface no disponible');
      }
    }
    
    // Funci√≥n para logout
    function logout() {
      console.log('üö™ Iniciando logout...');
      if (window.AndroidInterface && window.AndroidInterface.logout) {
        window.AndroidInterface.logout();
      } else {
        console.error('‚ùå AndroidInterface.logout no disponible');
        // Fallback: limpiar localStorage y recargar
        localStorage.clear();
        location.reload();
      }
    }
    
    // üíæ CREAR ESTRUCTURA DE DATOS DEL USUARIO
    async function createUserData(user, nick = null) {
      try {
        const now = new Date().toISOString();
        const userData = {
          uid: user.uid,
          email: user.email,
          displayName: user.displayName,
          photoURL: user.photoURL,
          createdAt: now,
          lastLogin: now,
          
          // Configuraci√≥n
          settings: {
            sound: true,
            vibration: true
          },
          
          // Vidas
          lives: {
            current: 3,
            max: 3,
            lastLost: null,
            regenTime: 30 // minutos
          },
          
          // Progreso por modo
          progress: {
            beginner: {
              level: 1,
              coins: 0,
              bestTime: null,
              bestFlips: null
            },
            normal: {
              level: 1,
              coins: 0,
              bestTime: null,
              bestFlips: null
            },
            extreme: {
              level: 1,
              coins: 0,
              bestTime: null,
              bestFlips: null
            }
          }
        };
        
        // Guardar en localStorage (modo local)
        const memoflipUserData = {
          uid: user.uid,
          displayName: user.displayName,
          nick: nick || user.nick,
          email: user.email
        };
        console.log('üíæ Guardando memoflip_user:', memoflipUserData);
        localStorage.setItem('memoflip_user', JSON.stringify(memoflipUserData));
        
        // Guardar en Firestore nativo
        if (window.AndroidInterface && window.AndroidInterface.saveUserData) {
          console.log('üî• Guardando en Firestore nativo...');
          window.AndroidInterface.saveUserData(JSON.stringify(memoflipUserData));
            } else {
          console.log('‚ö†Ô∏è AndroidInterface no disponible para Firestore');
        }
        
        // Guardar datos completos
        localStorage.setItem('user', JSON.stringify(userData));
        localStorage.setItem('userSettings', JSON.stringify(userData.settings));
        localStorage.setItem('userLives', JSON.stringify(userData.lives));
        localStorage.setItem('userProgress', JSON.stringify(userData.progress));
        
        console.log('‚úÖ Datos de usuario guardados localmente');
        
      } catch (error) {
        console.error('‚ùå Error creando datos de usuario:', error);
      }
    }
    
    // üéÆ FUNCIONES PARA MODAL DE NICK
    let currentUser = null;
    
    function showNickModal(user = null) {
      currentUser = user;
      document.getElementById('nickModal').classList.remove('hidden');
      
      // Auto-focus en el input
      setTimeout(() => {
        document.getElementById('nickInput').focus();
      }, 100);
    }
    
    
    function confirmNick() {
      const nick = document.getElementById('nickInput').value.trim();
      
      if (!nick) {
        alert('‚ö†Ô∏è Por favor, introduce tu nick');
        return;
      }
      
      if (nick.length < 2) {
        alert('‚ö†Ô∏è El nick debe tener al menos 2 caracteres');
        return;
      }
      
      console.log('üéÆ Confirmando nick:', nick);
      saveNick(nick);
    }
    
    function closeNickPrompt() {
      document.getElementById('nickModal').style.display = 'none';
    }
    
    // Enter para confirmar nick
        document.addEventListener('DOMContentLoaded', function() {
      const nickInput = document.getElementById('nickInput');
      if (nickInput) {
        nickInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            confirmNick();
          }
        });
      }
    });
    
    // Event listener para bot√≥n Google
    document.getElementById('btn-google-login').onclick = loginWithGoogle;
    </script>

    <!-- ===== MODAL AYUDA DE MODOS ===== -->
    <div id="help-modal" class="modal-overlay hidden">
      <div class="modal-backdrop" onclick="closeHelpModal()"></div>
      
      <div class="help-modal-box">
        <!-- Header -->
        <div class="help-modal-header">
          <div class="header-left">
            <div class="header-icon">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z"/>
                <path d="M6 9H4.5a1 1 0 0 1 0-5H6"/>
                <path d="M18 9h1.5a1 1 0 0 0 0-5H18"/>
                <path d="M6 15H4.5a1 1 0 0 0 0 5H6"/>
                <path d="M18 15h1.5a1 1 0 0 1 0 5H18"/>
                <circle cx="9" cy="9" r="1"/>
                <circle cx="15" cy="9" r="1"/>
              </svg>
            </div>
            <h2 class="header-title">Modos de Juego</h2>
          </div>
          <button class="btn-close" onclick="closeHelpModal()">‚úï</button>
        </div>
        
        <!-- Content -->
        <div class="help-modal-content">
          
          <!-- MODOS -->
          <div class="help-section">
            <h3 class="help-section-title">Modos Disponibles</h3>
            
            <div class="mode-help-item">
              <div class="mode-help-icon">
                <img src="relax.png" alt="Relax" class="help-mode-icon">
              </div>
              <div class="mode-help-text">
                <h3>Relax (Principiante)</h3>
                <p>¬°Perfecto para empezar! Sin prisa, sin presi√≥n. Solo t√∫, las cartas y tu memoria. Ideal para relajarte y mejorar paso a paso.</p>
              </div>
            </div>
            
            <div class="mode-help-item">
              <div class="mode-help-icon">
                <img src="normal.png" alt="Normal" class="help-mode-icon">
              </div>
              <div class="mode-help-text">
                <h3>Normal</h3>
                <p>El equilibrio perfecto. Tiempo limitado y mec√°nicas especiales que van apareciendo. ¬°Para cuando ya tienes experiencia!</p>
              </div>
            </div>
            
            <div class="mode-help-item">
              <div class="mode-help-icon">
                <img src="extremo.png" alt="Extremo" class="help-mode-icon">
              </div>
              <div class="mode-help-text">
                <h3>Extremo</h3>
                <p>¬°No te conf√≠es! Niveles casi imposibles desde el primer momento. Solo para verdaderos maestros de la memoria. ¬øTe atreves?</p>
              </div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
</body>
</html>

