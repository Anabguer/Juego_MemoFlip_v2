# ğŸ® CONTEXTO COMPLETO PARA NUEVO JUEGO

## ğŸ“‹ **INFORMACIÃ“N PARA CURSOR**

> "Tengo un sistema multi-aplicaciÃ³n funcionando con recetas, base de datos en Hostalia, sistema de autenticaciÃ³n, etc. Quiero crear un nuevo juego HTML que use la misma infraestructura. Toda la informaciÃ³n estÃ¡ en CONTEXTO_NUEVO_JUEGO.md y la estructura SQL en database/estructura_juego_nuevo.sql."


Este documento contiene TODO el contexto necesario para crear un nuevo juego que se integre con el sistema multi-aplicaciÃ³n ya existente.

---

## ğŸ—ï¸ **1. ARQUITECTURA DEL SISTEMA ACTUAL**

### **ğŸ¯ Sistema Multi-AplicaciÃ³n Funcionando**
- âœ… **App de Recetas**: Completamente funcional con APK nativa
- âœ… **Base de datos Hostalia**: 303+ recetas, usuarios registrados
- âœ… **Sistema de autenticaciÃ³n**: Usuario por aplicaciÃ³n
- âœ… **Uploads**: Sistema de archivos escalable
- âœ… **APK nativa**: Generada con Android Studio

### **ğŸ”‘ Concepto Clave: Usuario-AplicaciÃ³n**
Cada usuario puede estar en mÃºltiples aplicaciones usando la clave Ãºnica:
- **Formato**: `email_appcodigo`
- **Ejemplo**: `usuario@gmail.com_recetas`, `usuario@gmail.com_puzzle`
- **Ventaja**: Mismo usuario, diferentes apps, datos separados

---

## ğŸ—„ï¸ **2. BASE DE DATOS HOSTALIA**

### **ğŸ“¡ ConexiÃ³n Actual**
```php
Host: PMYSQL165.dns-servicio.com
Usuario: sistema_apps_user
ContraseÃ±a: GestionUploadSistemaApps!
BD: 9606966_sistema_apps_db
Charset: utf8
Puerto: 3306
```

### **ğŸ“Š Tablas Existentes**
```sql
-- TABLA PRINCIPAL (YA EXISTE)
usuarios_aplicaciones (
    usuario_aplicacion_id    INT(11)      AUTO_INCREMENT PRIMARY KEY,
    usuario_aplicacion_key   VARCHAR(150) NOT NULL UNIQUE,  -- email_appcodigo
    email                    VARCHAR(255) NOT NULL,
    nombre                   VARCHAR(255) NOT NULL,
    password_hash            VARCHAR(255) NOT NULL,
    app_codigo               VARCHAR(50)  NOT NULL,          -- 'recetas', 'puzzle', etc.
    fecha_registro           TIMESTAMP    DEFAULT CURRENT_TIMESTAMP,
    ultimo_acceso            TIMESTAMP    DEFAULT CURRENT_TIMESTAMP,
    activo                   TINYINT(1)   DEFAULT 1,
    configuracion            LONGTEXT     NULL
);

-- TABLA APLICACIONES (YA EXISTE)
aplicaciones (
    app_id INT AUTO_INCREMENT PRIMARY KEY,
    app_codigo VARCHAR(50) UNIQUE NOT NULL,    -- 'recetas', 'puzzle', etc.
    app_nombre VARCHAR(255) NOT NULL,
    app_descripcion TEXT,
    app_version VARCHAR(20) DEFAULT '1.0.0',
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    activo BOOLEAN DEFAULT TRUE,
    configuracion JSON
);

-- TABLA RECETAS (YA EXISTE - 303+ registros)
recetas (
    receta_id INT AUTO_INCREMENT PRIMARY KEY,
    usuario_aplicacion_key VARCHAR(150) NOT NULL,
    receta_nombre VARCHAR(255) NOT NULL,
    receta_tipo ENUM('Entrante', 'Principal', 'Postre', 'Bebida', 'Extra'),
    -- ... mÃ¡s campos
);
```

### **ğŸ†• Tabla para Nuevo Juego (CREAR)**
```sql
-- EJEMPLO PARA JUEGO PUZZLE
CREATE TABLE puzzle_partidas (
    partida_id INT AUTO_INCREMENT PRIMARY KEY,
    usuario_aplicacion_key VARCHAR(150) NOT NULL,  -- OBLIGATORIO: mismo formato
    puzzle_nombre VARCHAR(255) NOT NULL,
    puzzle_dificultad ENUM('FÃ¡cil', 'Medio', 'DifÃ­cil') DEFAULT 'FÃ¡cil',
    puzzle_imagen VARCHAR(500),
    puzzle_completado BOOLEAN DEFAULT FALSE,
    tiempo_segundos INT DEFAULT 0,
    puntuacion INT DEFAULT 0,
    movimientos INT DEFAULT 0,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_modificacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_usuario (usuario_aplicacion_key),
    FOREIGN KEY (usuario_aplicacion_key) REFERENCES usuarios_aplicaciones(usuario_aplicacion_key)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
```

---

## ğŸ“ **3. ESTRUCTURA DE ARCHIVOS ACTUAL**

La estructura en hostalia es:
directoprio Raiz: sistema_apps_upload
subdirectorios_ 	sistema_apps_api
			sistema_apps_upload

En el directorio Raiz estÃ¡n los archivos: app_memory.html	- aplicaciÃ³n  de moemory
					  app_recetas.html	- aplicaciÃ³n de recetas
					  
					  manifest_recetas.json - Icono de la aplicaciÃ³n recetas
			se deberÃ­a crear  manifest_memory.json  - Icono de la aplicaciÃ³n memoty
					  router.html		- Router donde va la informaciÃ³n de la aplicaciÃ³n
					  index.html		- Indice de las aplicaciones existentes

En sistema_apps_api- memory   estÃ¡n los archivos que subiste...examina si estÃ¡n todos correctos y si no utiliza la estructa correcta  sistema_apps_api/memory para organizar tu aplicaciÃ³n.

### **ğŸ¯ Proyecto Principal (mis_recetas)**
```
C:\xampp\htdocs\mis_recetas\
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ database.php          # ConexiÃ³n BD (localhost + Hostalia)
â”‚   â”œâ”€â”€ app_config.php        # Config app recetas
â”‚   â””â”€â”€ production_config.php # Config producciÃ³n
â”œâ”€â”€ includes/
â”‚   â”œâ”€â”€ auth_final.php        # Sistema autenticaciÃ³n
â”‚   â””â”€â”€ security.php          # Funciones seguridad
â”œâ”€â”€ api/                      # APIs REST
â”‚   â”œâ”€â”€ create-recipe.php
â”‚   â”œâ”€â”€ get-recipe.php
â”‚   â””â”€â”€ update-recipe.php
â”œâ”€â”€ PARA_HOSTALIA/           # Para subir a producciÃ³n
â”‚   â””â”€â”€ sistema_apps_upload/
â”‚       â”œâ”€â”€ app_recetas.html  # App web completa
â”‚       â””â”€â”€ sistema_apps_api/ # APIs para Hostalia
â””â”€â”€ database/
    â””â”€â”€ migrate_to_hostalia.php # MigraciÃ³n datos
```

### **ğŸŒ Hostalia (ProducciÃ³n)**
```
https://colisan.com/sistema_apps_upload/
â”œâ”€â”€ app_recetas.html          # App recetas funcionando
â”œâ”€â”€ sistema_apps_api/
â”‚   â””â”€â”€ recetas/              # APIs especÃ­ficas
â””â”€â”€ sistema_apps_upload/
    â””â”€â”€ recetas/              # Uploads especÃ­ficos
```

---

## âš™ï¸ **4. CONFIGURACIÃ“N DE ARCHIVOS**

### **ğŸ”§ config/database.php (YA EXISTE)**
```php
// DetecciÃ³n automÃ¡tica localhost vs producciÃ³n
$isLocalhost = false; // FORZAR PRODUCCIÃ“N PARA HOSTALIA

if ($isLocalhost) {
    // LOCALHOST
    define('DB_HOST', 'localhost');
    define('DB_USUARIO', 'root');
    define('DB_CONTRA', '');
    define('DB_NOMBRE', 'sistema_apps_db');
} else {
    // HOSTALIA
    define('DB_HOST', 'PMYSQL165.dns-servicio.com');
    define('DB_USUARIO', 'sistema_apps_user');
    define('DB_CONTRA', 'GestionUploadSistemaApps!');
    define('DB_NOMBRE', '9606966_sistema_apps_db');
}
```

### **ğŸ® config/app_config_[JUEGO].php (CREAR)**
```php
// ConfiguraciÃ³n especÃ­fica del juego
define('APP_CODIGO', 'puzzle');  // CAMBIAR segÃºn el juego
define('APP_NOMBRE', 'Juego de Puzzle');
define('APP_VERSION', '1.0.0');

// URLs para Hostalia
define('API_BASE_URL', 'https://colisan.com/sistema_apps_upload/sistema_apps_api/');
define('UPLOAD_BASE_URL', 'https://colisan.com/sistema_apps_upload/uploads/');

// FunciÃ³n para generar usuario_key
function generateUserAppKey($email, $app_codigo = null) {
    $app_codigo = $app_codigo ?? APP_CODIGO;
    return $email . '_' . $app_codigo;
}
```

---

## ğŸ” **5. SISTEMA DE AUTENTICACIÃ“N**

### **ğŸ“ includes/auth_final.php (YA EXISTE)**
```php
class AuthFinal {
    private $app_codigo;
    
    public function __construct($pdo, $app_codigo = null) {
        $this->app_codigo = $app_codigo ?? APP_CODIGO;
    }
    
    // Registrar usuario en aplicaciÃ³n especÃ­fica
    public function registerUser($email, $nombre, $password) {
        $usuario_aplicacion_key = generateUserAppKey($email, $this->app_codigo);
        // Inserta en usuarios_aplicaciones con app_codigo especÃ­fico
    }
    
    // Login en aplicaciÃ³n especÃ­fica
    public function loginUser($email, $password) {
        $usuario_aplicacion_key = generateUserAppKey($email, $this->app_codigo);
        // Busca en usuarios_aplicaciones WHERE app_codigo = 'puzzle'
    }
}
```

### **ğŸ”‘ Uso en el Juego**
```php
// Inicializar auth para el juego especÃ­fico
$authPuzzle = new AuthFinal($pdo, 'puzzle');

// Login/registro automÃ¡ticamente usa la app correcta
$result = $authPuzzle->loginUser('usuario@email.com', 'password');
// Genera: usuario@email.com_puzzle

// Verificar sesiÃ³n
if ($authPuzzle->isLoggedIn()) {
    $usuario_key = $authPuzzle->getCurrentUserKey(); // usuario@email.com_puzzle
}
```

---

## ğŸ“± **6. ESTRUCTURA PARA NUEVO JUEGO**

### **ğŸ“‚ Archivos a Crear**
```
mis_recetas/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ app_config_[JUEGO].php    # Config especÃ­fica del juego
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ create-[JUEGO].php        # Crear partida/datos
â”‚   â”œâ”€â”€ get-[JUEGO].php           # Obtener datos
â”‚   â”œâ”€â”€ update-[JUEGO].php        # Actualizar progreso
â”‚   â””â”€â”€ delete-[JUEGO].php        # Eliminar datos
â”œâ”€â”€ PARA_HOSTALIA/
â”‚   â””â”€â”€ sistema_apps_upload/
â”‚       â”œâ”€â”€ app_[JUEGO].html      # App web del juego
â”‚       â””â”€â”€ sistema_apps_api/
â”‚           â””â”€â”€ [JUEGO]/          # APIs especÃ­ficas
â””â”€â”€ database/
    â””â”€â”€ estructura_[JUEGO].sql    # Estructura BD del juego
```

### **ğŸŒ Para Subir a Hostalia**
```
sistema_apps_upload/
â”œâ”€â”€ app_[JUEGO].html              # App web
â”œâ”€â”€ sistema_apps_api/
â”‚   â””â”€â”€ [JUEGO]/                  # APIs del juego
â”‚       â”œâ”€â”€ config.php            # Config Hostalia
â”‚       â”œâ”€â”€ auth.php              # AutenticaciÃ³n
â”‚       â”œâ”€â”€ create.php            # Crear datos
â”‚       â”œâ”€â”€ get.php               # Obtener datos
â”‚       â””â”€â”€ update.php            # Actualizar datos
â””â”€â”€ sistema_apps_upload/
    â””â”€â”€ [JUEGO]/                  # Uploads del juego
        â””â”€â”€ upload_handler.php    # Manejo uploads
```

---

## ğŸš€ **7. PROCESO DE IMPLEMENTACIÃ“N**

### **ğŸ“‹ Pasos para Crear Nuevo Juego**

1. **ğŸ—„ï¸ Crear estructura BD**
   ```sql
   -- Ejecutar en Hostalia
   SOURCE estructura_juego_nuevo.sql;
   ```

2. **âš™ï¸ Crear configuraciÃ³n**
   ```php
   // config/app_config_[JUEGO].php
   define('APP_CODIGO', '[nombre_juego]');
   ```

3. **ğŸ” Configurar autenticaciÃ³n**
   ```php
   // Usar AuthFinal con app_codigo especÃ­fico
   $auth = new AuthFinal($pdo, '[nombre_juego]');
   ```

4. **ğŸ“± Crear app HTML**
   ```html
   <!-- app_[JUEGO].html -->
   <!-- Usar mismo patrÃ³n que app_recetas.html -->
   ```

5. **ğŸŒ Crear APIs**
   ```php
   // api/create-[JUEGO].php, get-[JUEGO].php, etc.
   // Usar usuario_aplicacion_key para datos
   ```

6. **ğŸ“¤ Subir a Hostalia**
   ```
   sistema_apps_upload/
   â”œâ”€â”€ app_[JUEGO].html
   â””â”€â”€ sistema_apps_api/[JUEGO]/
   ```

7. **ğŸ“± Generar APK**
   ```
   // Usar Android Studio como con recetas
   // Cambiar package name y URL
   ```

---

## ğŸ”— **8. URLs Y ENDPOINTS**

### **ğŸŒ URLs Base**
```
Desarrollo: http://localhost/mis_recetas/
ProducciÃ³n: https://colisan.com/sistema_apps_upload/
```

### **ğŸ“¡ APIs**
```
GET    /api/get-[JUEGO].php?usuario_key=...
POST   /api/create-[JUEGO].php
PUT    /api/update-[JUEGO].php
DELETE /api/delete-[JUEGO].php
```

### **ğŸ“¤ Uploads**
```
Base: https://colisan.com/sistema_apps_upload/uploads/
Estructura: uploads/usuario@email.com_[JUEGO]/archivo.jpg
```

---

## ğŸ¯ **9. EJEMPLOS PRÃCTICOS**

### **ğŸ“ Registro de Usuario en Juego**
```php
// El usuario ya existe en recetas
// email: usuario@gmail.com
// usuario_key recetas: usuario@gmail.com_recetas

// Registrar en nuevo juego
$authPuzzle = new AuthFinal($pdo, 'puzzle');
$result = $authPuzzle->registerUser('usuario@gmail.com', 'Usuario', 'password');
// Crea: usuario@gmail.com_puzzle
```

### **ğŸ® Guardar Partida**
```php
$usuario_key = 'usuario@gmail.com_puzzle';
$stmt = $pdo->prepare("
    INSERT INTO puzzle_partidas 
    (usuario_aplicacion_key, puzzle_nombre, puntuacion, tiempo_segundos) 
    VALUES (?, ?, ?, ?)
");
$stmt->execute([$usuario_key, 'Puzzle 1', 1500, 120]);
```

### **ğŸ“Š Obtener EstadÃ­sticas**
```php
$stmt = $pdo->prepare("
    SELECT COUNT(*) as partidas, MAX(puntuacion) as mejor_puntuacion
    FROM puzzle_partidas 
    WHERE usuario_aplicacion_key = ?
");
$stmt->execute(['usuario@gmail.com_puzzle']);
```

---

## âš ï¸ **10. CONSIDERACIONES IMPORTANTES**

### **ğŸ”‘ Campo Obligatorio**
- **SIEMPRE usar `usuario_aplicacion_key`** en todas las tablas del juego
- **Formato**: `email_appcodigo`
- **Longitud**: VARCHAR(150)
- **Ãndice**: Crear Ã­ndice en este campo

### **ğŸŒ Compatibilidad**
- Usar mismo sistema de autenticaciÃ³n que recetas
- Mantener estructura de archivos similar
- Reutilizar configuraciones de Hostalia

### **ğŸ“± APK**
- Cambiar package name en Android Studio
- Actualizar URL base en la app
- Mantener misma estructura WebView

### **ğŸ—„ï¸ Base de Datos**
- NO tocar tablas existentes (`usuarios_aplicaciones`, `aplicaciones`, `recetas`)
- Crear solo tablas especÃ­ficas del juego
- Usar mismo charset (utf8) y engine (InnoDB)

---

## ğŸ¯ **11. COMANDOS ÃšTILES**

### **ğŸ” Verificar ConexiÃ³n BD**
```php
// Agregar a cualquier archivo
?debug_db=true
```

### **âš™ï¸ Ver ConfiguraciÃ³n**
```php
// Agregar a cualquier archivo
?debug_config=true
```

### **ğŸ“Š Ver Usuarios Registrados**
```sql
SELECT 
    app_codigo,
    COUNT(*) as usuarios,
    MAX(fecha_registro) as ultimo_registro
FROM usuarios_aplicaciones 
GROUP BY app_codigo;
```

---

## ğŸ® **12. TIPOS DE JUEGOS SUGERIDOS**

### **ğŸ§© Puzzle Games**
- Rompecabezas de imÃ¡genes
- Sudoku
- Tetris
- Block Puzzle

### **ğŸ¯ Arcade Games**
- Snake
- Pac-Man
- Breakout
- Space Invaders

### **ğŸ§  Memory Games**
- Memory cards
- Simon Says
- Sequence memory

### **ğŸƒ Action Games**
- Runner infinito
- Platformer simple
- Tower defense bÃ¡sico

---

## ğŸ“ **13. SOPORTE Y REFERENCIAS**

### **ğŸ“ Archivos de Referencia**
- `app_recetas.html` - Estructura completa de app
- `auth_final.php` - Sistema de autenticaciÃ³n
- `database.php` - ConfiguraciÃ³n de BD
- `migrate_to_hostalia.php` - Ejemplo de migraciÃ³n

### **ğŸ”— URLs de Referencia**
- Hostalia: https://colisan.com/sistema_apps_upload/
- App Recetas: https://colisan.com/sistema_apps_upload/app_recetas.html
- APIs: https://colisan.com/sistema_apps_upload/sistema_apps_api/

---

**âœ… Con esta informaciÃ³n, Cursor tiene TODO el contexto necesario para crear un nuevo juego que se integre perfectamente con el sistema existente.**
